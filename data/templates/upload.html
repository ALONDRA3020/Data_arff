<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Subir dataset KDD - Visualización</title>

  <!-- Estilos simples y responsivos -->
  <style>
    :root{
      --bg:#f7f8fb;
      --card:#ffffff;
      --muted:#6b7280;
      --accent:#2563eb;
      --shadow: 0 6px 18px rgba(15, 23, 42, 0.06);
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    body{ background:var(--bg); margin:0; padding:32px; color:#111827; }
    .container{ max-width:1100px; margin:0 auto; }
    header{ margin-bottom:20px; }
    h1{ margin:0 0 6px; font-size:20px; }
    p.lead{ margin:0; color:var(--muted); font-size:14px; }

    .card{ background:var(--card); border-radius:12px; padding:18px; box-shadow:var(--shadow); margin-bottom:16px; }
    .grid{ display:grid; grid-template-columns: 1fr 360px; gap:16px; }
    .full{ grid-column: 1 / -1; }

    form{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    input[type="file"]{ padding:6px; }
    button.primary{
      background:var(--accent); color:white; border:0; padding:10px 14px; border-radius:8px; cursor:pointer;
      box-shadow:0 6px 12px rgba(37,99,235,0.12);
    }
    .meta{ font-size:14px; color:var(--muted); display:flex; gap:12px; align-items:center; flex-wrap:wrap; }

    ul.columns{ list-style:none; padding:0; margin:8px 0 0; display:flex; flex-wrap:wrap; gap:8px; }
    ul.columns li{ background:#f1f5f9; padding:6px 8px; border-radius:6px; font-size:13px; color:#0f172a; }

    .graphs-grid{ display:grid; grid-template-columns: repeat(auto-fill,minmax(260px,1fr)); gap:14px; margin-top:12px; }
    .graph-card{ background:#fff; border-radius:10px; padding:10px; text-align:center; box-shadow: 0 4px 10px rgba(2,6,23,0.04); }
    .graph-card img{ max-width:100%; height:auto; border-radius:6px; display:block; margin:0 auto 8px; }
    .graph-title{ font-size:13px; color:#111827; margin-bottom:4px; font-weight:600; }
    .graph-muted{ font-size:12px; color:var(--muted); }

    .placeholder{
      height:160px; display:flex; align-items:center; justify-content:center; color:var(--muted);
      border:2px dashed #e6eefc; border-radius:8px; background:linear-gradient(180deg,#ffffff,#fbfdff);
    }

    @media (max-width:880px){
      .grid{ grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Subir dataset KDD y mostrar gráficas</h1>
      <p class="lead">Sube un archivo .arff (KDD) y el sistema generará distribuciones por <code>protocol_type</code> para train/val/test y dataset completo.</p>
    </header>

    <div class="card">
      <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <label for="id_file" style="font-weight:600;">Archivo (.arff)</label>
        <input id="id_file" type="file" name="file" accept=".arff,.txt" required>
        <button class="primary" type="submit">Subir y procesar</button>
        <div style="flex:1"></div>
        <div class="meta">
          <span>Filas: <strong>{{ rows|default:"—" }}</strong></span>
          <span>Columnas: <strong>{{ columns|length|default:"—" }}</strong></span>
        </div>
      </form>

      <!-- Lista de columnas (si existen) -->
      {% if columns %}
        <div style="margin-top:12px;">
          <strong>Columnas:</strong>
          <ul class="columns">
            {% for c in columns %}
              <li>{{ c }}</li>
            {% endfor %}
          </ul>
        </div>
      {% else %}
        <div style="margin-top:12px; color:var(--muted);">Aún no se ha subido un archivo o no se encontraron columnas.</div>
      {% endif %}
    </div>

    <div class="grid">
      <div class="card">
        <h3 style="margin:0 0 8px;">Gráficas generadas</h3>
        <p class="lead" style="margin-bottom:12px;">Distribución de <code>protocol_type</code> en los distintos subconjuntos (si está presente en el dataset).</p>

        {% if graphs %}
          <div class="graphs-grid">
            {% for img, title in graphs %}
              <div class="graph-card">
                <div class="graph-title">{{ title }}</div>
                {% if img %}
                  <img src="data:image/png;base64,{{ img }}" alt="{{ title }}" />
                  <div class="graph-muted">SVG/PNG embebido</div>
                {% else %}
                  <div class="placeholder">No se pudo generar la gráfica</div>
                {% endif %}
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="placeholder full" style="margin-top:8px;">No hay gráficas para mostrar. Sube un archivo .arff válido.</div>
        {% endif %}
      </div>

      <div class="card">
        <h3 style="margin-top:0;">Ayuda rápida</h3>
        <p class="meta" style="margin-top:6px;">
          - El view espera que la columna <code>protocol_type</code> exista para generar las gráficas.<br>
          - Si las gráficas aparecen vacías, revisa que el archivo esté en formato ARFF y que la lectura no falle por codificación.
        </p>

        <hr style="margin:12px 0;" />
        <h4 style="margin:0 0 6px;">Sugerencias</h4>
        <ul style="margin:0; padding-left:18px; color:var(--muted);">
          <li>Si quieres previsualizar filas, modifica el contexto para enviar un <code>head</code> del dataframe.</li>
          <li>Para más gráficas (ej. por clase), añade la lógica en tu view y envía imágenes adicionales en el zip <code>graphs</code>.</li>
        </ul>
      </div>
    </div> <!-- /grid -->

  </div> <!-- /container -->
</body>
</html>